# SIDEBAR CART
st.sidebar.header("Your Cart")

if st.session_state.cart:

    # Count quantities
    cart_summary = {}
    for item in st.session_state.cart:
        name = item["name"]
        price = item["price"]
        if name not in cart_summary:
            cart_summary[name] = {"price": price, "qty": 0}
        cart_summary[name]["qty"] += 1

    total = 0

    for name, info in cart_summary.items():
        qty = info["qty"]
        price = info["price"]
        subtotal = qty * price
        total += subtotal

        minus_col, item_col, plus_col, price_col = st.sidebar.columns([1, 4, 1, 2])

        # Minus button
        with minus_col:
            if st.button("-", key=f"minus_{name}"):
                # Remove ONE of that item
                for i, item in enumerate(st.session_state.cart):
                    if item["name"] == name:
                        st.session_state.cart.pop(i)
                        break

        # Item name + quantity
        with item_col:
            st.write(f"{name} Ã— {qty}")

        # Plus button
        with plus_col:
            if st.button("+", key=f"plus_{name}"):
                st.session_state.cart.append({"name": name, "price": price})

        # Subtotal for that item
        with price_col:
            st.write(f"NT${subtotal}")

    st.sidebar.write(f"**Total: NT${total}**")

else:
    st.sidebar.info("Your cart is empty.")
